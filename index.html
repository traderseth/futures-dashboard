<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Futures Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
          body { background-color: #111827; }
          @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-33.33%); } }
          .animate-scroll { animation: scroll 25s linear infinite; }
        </style>
  </head>
  <body class="min-h-screen text-white p-5">
      <div id="app"><div class="text-center py-20"><h1 class="text-2xl">Loading live data...</h1>h1></div>div></div>div>
      <script>
            const FINNHUB_KEY = 'ctv766hr01qhup6og9p0ctv766hr01qhup6og9pg';
            const FUTURES = [
              { symbol: 'DX=F', finnhub: 'OANDA:USD_IDX', name: 'US Dollar', color: '#22c55e', url: 'https://www.investing.com/currencies/us-dollar-index' },
              { symbol: 'SI=F', finnhub: 'OANDA:XAG_USD', name: 'Silver', color: '#a1a1aa', url: 'https://www.investing.com/commodities/silver' },
              { symbol: 'CL=F', finnhub: 'OANDA:WTICO_USD', name: 'Crude Oil', color: '#f97316', url: 'https://www.investing.com/commodities/crude-oil' },
              { symbol: 'GC=F', finnhub: 'OANDA:XAU_USD', name: 'Gold', color: '#eab308', url: 'https://www.investing.com/commodities/gold' },
              { symbol: 'ES=F', finnhub: 'OANDA:SPX500_USD', name: 'S&P 500', color: '#3b82f6', url: 'https://www.investing.com/indices/us-spx-500-futures' },
                  ];
            const NEWS = [
              { title: "Gold futures rally on safe-haven demand", source: "Kitco", time: 2, cat: "commodities" },
              { title: "Iran oil exports face new scrutiny amid sanctions", source: "Reuters", time: 5, cat: "iran" },
              { title: "Congress faces deadline on government funding bill", source: "AP", time: 3, cat: "shutdown" },
              { title: "Silver outperforms gold in early trading", source: "Reuters", time: 8, cat: "commodities" },
              { title: "OPEC+ considers response to Iran production levels", source: "Bloomberg", time: 15, cat: "iran" },
              { title: "House Republicans debate spending priorities", source: "Politico", time: 12, cat: "shutdown" },
                  ];
            let priceHistory = {}, combinedChart = null, tickCount = 0, prices = {};
            FUTURES.forEach(f => { priceHistory[f.symbol] = []; prices[f.symbol] = { price: 0, prev: 0 }; });

            async function fetchPrices() {
                    const results = [];
                    for (const f of FUTURES) {
                              try {
                                          const res = await fetch('https://finnhub.io/api/v1/quote?symbol=' + f.finnhub + '&token=' + FINNHUB_KEY);
                                          const d = await res.json();
                                          if (d && d.c) {
                                                        prices[f.symbol].prev = prices[f.symbol].price || d.pc || d.c;
                                                        prices[f.symbol].price = d.c;
                                                        const chg = ((d.c - d.pc) / d.pc) * 100;
                                                        results.push({ ...f, price: d.c, change: chg, pc: d.pc });
                                          }
                              } catch (e) { console.log('Err', f.name, e); }
                    }
                    return results;
            }

            async function render() {
                    tickCount++;
                    const data = await fetchPrices();
                    if (!data.length) return;
                    data.forEach(p => {
                              priceHistory[p.symbol].push({ t: tickCount, p: p.price, c: ((p.price - p.pc) / p.pc) * 100 });
                              if (priceHistory[p.symbol].length > 30) priceHistory[p.symbol].shift();
                    });
                    const ticker = [...data, ...data, ...data];
                    const time = new Date().toLocaleTimeString();
                    const catColors = { commodities: 'border-yellow-500', iran: 'border-red-500', shutdown: 'border-blue-500' };
                    const fmt = m => m < 60 ? m + 'm ago' : Math.floor(m/60) + 'h ago';

                    document.getElementById('app').innerHTML = 
                              '<div class="bg-black rounded-lg mb-5 overflow-hidden sticky top-0 z-50"><div class="flex animate-scroll whitespace-nowrap py-4">' +
                              ticker.map(p => '<span class="px-8 font-medium text-lg ' + (p.change >= 0 ? 'text-green-500' : 'text-red-500') + '"><span class="text-gray-400 mr-2">' + p.name + '</span>' + (p.change >= 0 ? 'â–²' : 'â–¼') + ' ' + Math.abs(p.change).toFixed(2) + '%</span>').join('') +
                              '</div></div>' +
                              '<div class="flex justify-between items-center mb-5 flex-wrap gap-4"><div><h1 class="text-3xl font-bold">Futures Dashboard</h1><p class="text-gray-400">Live prices via Finnhub API</p></div><div class="flex items-center gap-4"><span class="bg-green-500 px-5 py-2 rounded-md animate-pulse">â— LIVE</span><span class="text-gray-500 text-sm">' + time + '</span></div></div>' +
                              '<div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">' +
                              data.map(p => '<a href="' + p.url + '" target="_blank" class="bg-gray-800 rounded-xl p-4 block hover:bg-gray-700" style="border-left:4px solid ' + p.color + '"><div class="flex justify-between mb-1"><span class="text-gray-400 text-sm">' + p.name + '</span><span class="text-blue-400 text-sm">â†—</span></div><div class="text-2xl font-bold">$' + p.price.toFixed(2) + '</div><div class="text-base ' + (p.change >= 0 ? 'text-green-500' : 'text-red-500') + '">' + (p.change >= 0 ? 'â–²+' : 'â–¼') + p.change.toFixed(2) + '%</div></a>').join('') +
                              '</div>' +
                              '<div class="bg-gray-800 rounded-xl p-4 mb-8"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">Price Movement (% from prev close)</h3><div class="flex gap-3 text-sm flex-wrap">' + data.map(p => '<span style="color:' + p.color + '">â— ' + p.name + '</span>').join('') + '</div></div><canvas id="chart" height="200"></canvas></div>' +
                              '<div><h2 class="text-2xl font-bold mb-4"><span class="text-green-500">â—</span> Live Feeds</h2><div class="bg-gray-800 rounded-xl overflow-hidden"><div class="grid grid-cols-3 divide-x divide-gray-700">' +
                              '<div class="p-2"><div class="text-center text-yellow-500 font-semibold pb-2 border-b border-gray-700 mb-2">ğŸ“ˆ Commodities</div>' + NEWS.filter(n => n.cat === 'commodities').map(n => '<div class="p-2 mb-1 bg-gray-700 rounded text-sm border-l-2 ' + catColors[n.cat] + '"><div class="text-white mb-1">' + n.title + '</div><div class="flex justify-between text-xs text-gray-400"><span>' + n.source + '</span><span>' + fmt(n.time) + '</span></div></div>').join('') + '</div>' +
                              '<div class="p-2"><div class="text-center text-red-500 font-semibold pb-2 border-b border-gray-700 mb-2">ğŸ‡®ğŸ‡· Iran</div>' + NEWS.filter(n => n.cat === 'iran').map(n => '<div class="p-2 mb-1 bg-gray-700 rounded text-sm border-l-2 ' + catColors[n.cat] + '"><div class="text-white mb-1">' + n.title + '</div><div class="flex justify-between text-xs text-gray-400"><span>' + n.source + '</span><span>' + fmt(n.time) + '</span></div></div>').join('') + '</div>' +
                              '<div class="p-2"><div class="text-center text-blue-500 font-semibold pb-2 border-b border-gray-700 mb-2">ğŸ›ï¸ Shutdown</div>' + NEWS.filter(n => n.cat === 'shutdown').map(n => '<div class="p-2 mb-1 bg-gray-700 rounded text-sm border-l-2 ' + catColors[n.cat] + '"><div class="text-white mb-1">' + n.title + '</div><div class="flex justify-between text-xs text-gray-400"><span>' + n.source + '</span><span>' + fmt(n.time) + '</span></div></div>').join('') + '</div>' +
                              '</div><div class="text-center text-gray-500 text-sm py-2 border-t border-gray-700">Live data refreshes every 60 seconds</div></div></div>';

                    const canvas = document.getElementById('chart');
                    if (canvas && priceHistory[FUTURES[0].symbol].length > 0) {
                              if (combinedChart) combinedChart.destroy();
                              combinedChart = new Chart(canvas.getContext('2d'), {
                                          type: 'line',
                                          data: {
                                                        labels: priceHistory[FUTURES[0].symbol].map(x => x.t),
                                                        datasets: FUTURES.map(f => ({ label: f.name, data: priceHistory[f.symbol].map(x => x.c), borderColor: f.color, borderWidth: 2, fill: false, tension: 0.3, pointRadius: 2 }))
                                          },
                                          options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } }, y: { grid: { color: '#374151' }, ticks: { color: '#9ca3af', callback: v => v.toFixed(2) + '%' } } } }
                              });
                    }
            }
            render();
            setInterval(render, 60000);
      </script>
  </body>body>
</html>html>
      </script>
    </style></title>
  </head>
